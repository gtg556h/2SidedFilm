#!/bin/python3

import numpy as np
import matplotlib.pyplot as plt
import PIVLib
import sys

filename = sys.argv[0]

p1 = PIVLib.PIV(filename)
if len(sys.argv)==2:
    scale = sys.argv[1]
else:
    scale=30
    

p1.quiver(scale)

p1.selectRegionSet(scale, 'set1')
p1.selectRegianSet(scale, 'set2')

set1 = PIVLib.RSOI(p1, len(p1.rsoi)-2)
set2 = PIVLib.RSOI(p1, len(p1.rsoi)-1)

dtheta = np.mod(set1-set2, 1)




#####################
# Save pickle:
data = {'p1': p1, 'set1': set1, 'set2': set2, 'dtheta': dtheta, 't': t}
output=re.sub(r'.npz', '.pkl', filename)
pickle.dump(data, open( output, "wb" ) )
# Load pickle:
# data = pickle.load( open( filename, "rb" ) )



######################
# Save numpy arrays:
output=re.sub(r'.npz', '_syncAnalysis.npz', filename)
np.savez(output,'dtheta'=dtheta, 't'=t, 'ix1'=set1.ix, 'theta1'=set1.theta, 'ix2'=set2.ix, 'theta2'=set2.theta)
# Load numpy array:
# data = np.load(filename)
# t = data['t']
# ...



plt.plot(dtheta)

#p = re.compile('.npz')
#string = p.sub('dtheta.eps', filename)
#plt.savefig(string)

plt.savefig(re.sub(r'.npz', '_dtheta.eps', filename))
plt.show()
